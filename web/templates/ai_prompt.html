{% extends "base.html" %}

{% block title %}Vex â€” Ù…Ø­Ø±Ø± Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ{% endblock %}

{% block head %}
<style>
    .prompt-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .prompt-textarea {
        width: 100%;
        min-height: 220px;
        background: var(--bg-hover);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-primary);
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        padding: 1rem;
        outline: none;
        resize: vertical;
        direction: ltr;
        box-sizing: border-box;
        transition: border-color 0.2s;
    }

    .prompt-textarea:focus {
        border-color: var(--primary-color);
    }

    .btn-save {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.65rem 1.5rem;
        font-family: inherit;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    .btn-save:hover {
        opacity: 0.9;
    }

    .btn-reset {
        background: #dc262622;
        color: #f87171;
        border: 1px solid #f8717133;
        border-radius: 8px;
        padding: 0.65rem 1.2rem;
        font-family: inherit;
        font-size: 0.95rem;
        font-weight: 700;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    .btn-reset:hover {
        opacity: 0.8;
    }

    .hint-box {
        background: #6366f111;
        border: 1px solid #6366f144;
        border-radius: 8px;
        padding: 0.85rem 1rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        direction: rtl;
    }

    .hint-box code {
        background: #ffffff15;
        padding: 0.1rem 0.4rem;
        border-radius: 4px;
        font-family: monospace;
        color: #a5b4fc;
    }

    .disabled-note {
        background: #f8717122;
        border: 1px solid #f8717144;
        border-radius: 8px;
        padding: 0.85rem 1rem;
        font-size: 0.9rem;
        color: #f87171;
        margin-bottom: 1.5rem;
        text-align: center;
        font-weight: 600;
    }

    .flash {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-weight: 600;
    }

    .flash-ok {
        background: #16a34a22;
        color: #4ade80;
    }
</style>
{% endblock %}

{% block nav %}
<nav class="navbar">
    <div class="nav-brand">
        <span class="nav-logo">ğŸ¤–</span>
        <span class="nav-title">Vex</span>
        <span class="nav-badge">@{{ bot_username }}</span>
    </div>
    <div class="nav-links">
        <a href="/dashboard/" class="nav-link">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="/dashboard/groups" class="nav-link">ğŸ‘¥ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</a>
        <a href="/dashboard/users" class="nav-link">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
        <a href="/dashboard/logs" class="nav-link">ğŸ“‘ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</a>
        <a href="/dashboard/ai-stats" class="nav-link">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
        <a href="/dashboard/ai-providers" class="nav-link">ğŸ¤– Ù…Ø²ÙˆØ¯Ùˆ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</a>
        <a href="/dashboard/ai-prompt" class="nav-link active">âœï¸ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</a>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="dashboard">
    <h1 class="page-title">âœï¸ Ù…Ø­Ø±Ø± Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
    <p style="color:var(--text-secondary);margin-bottom:1.5rem;">
        ÙŠÙØ±Ø³ÙÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ø¹ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙŠØ­Ù„Ù„Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ <code
            style="background:#ffffff15;padding:0.1rem 0.4rem;border-radius:4px;color:#a5b4fc;">{text}</code> Ø­ÙŠØ« ØªÙÙˆØ¶Ø¹
        Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
    </p>

    {% if not has_providers %}
    <div class="disabled-note">
        âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© â€” Ù„Ù… ØªÙØ¶Ù Ø£ÙŠ Ù…Ø²ÙˆØ¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø¹Ø¯.
        <br><a href="/dashboard/ai-providers" style="color:#f87171;">Ø£Ø¶Ù Ù…Ø²ÙˆØ¯Ø§Ù‹ Ù…Ù† Ù‡Ù†Ø§ â†’</a>
    </div>
    {% endif %}

    {% if msg %}
    <div class="flash flash-ok">{{ msg }}</div>
    {% endif %}

    <!-- Current prompt editor -->
    <div class="prompt-card">
        <h2 style="margin:0 0 1rem;font-size:1rem;">ğŸ“ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>

        <div class="hint-box">
            ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… <code>{text}</code> ÙƒÙ…ÙƒØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø¨Ø±ÙˆÙ…Ø¨ØªÙƒ.
            Ù…Ø«Ø§Ù„: <code>Ù‚ÙŠÙ‘Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: {text} â€” Ø£Ø¬Ø¨ Ø¨Ø±Ù‚Ù… 0.0-1.0 ÙÙ‚Ø·.</code>
        </div>

        <form method="post" action="/dashboard/ai-prompt/save">
            <textarea class="prompt-textarea" name="prompt" {% if not has_providers %}disabled{% endif
                %}>{{ current_prompt }}</textarea>
            <div style="display:flex;gap:1rem;margin-top:1rem;">
                <button type="submit" class="btn-save" {% if not has_providers %}disabled{% endif %}>ğŸ’¾ Ø­ÙØ¸
                    Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª</button>
            </div>
        </form>
    </div>

    <!-- Reset to default -->
    <div class="prompt-card">
        <h2 style="margin:0 0 0.5rem;font-size:1rem;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</h2>
        <p style="color:var(--text-secondary);font-size:0.9rem;margin:0 0 1rem;">
            Ù‡Ø°Ø§ ÙŠÙØ¹ÙŠØ¯ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ù…Ø¯Ù…Ø¬ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ„Ø§ ÙŠØ­Ø°Ù Ø£ÙŠ Ø´ÙŠØ¡ Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù….
        </p>
        <form method="post" action="/dashboard/ai-prompt/reset"
            onsubmit="return confirm('Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŸ')">
            <button type="submit" class="btn-reset" {% if not has_providers %}disabled{% endif %}>â™»ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø· Ø¥Ù„Ù‰
                Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        </form>
    </div>

    <!-- Default prompt reference -->
    <div class="prompt-card">
        <h2 style="margin:0 0 1rem;font-size:1rem;">ğŸ“‹ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡)</h2>
        <pre
            style="background:var(--bg-hover);border-radius:8px;padding:1rem;font-size:0.8rem;direction:ltr;overflow-x:auto;color:var(--text-secondary);margin:0;">{{ default_prompt }}</pre>
    </div>

    <!-- Debug Channel -->
    <div class="prompt-card"
        style="border-color:{% if debug_channel_id %}#6366f1{% else %}var(--border-color){% endif %};">
        <h2 style="margin:0 0 0.5rem;font-size:1rem;">ğŸ”¬ Ù‚Ù†Ø§Ø© Ø§Ù„ØªØªØ¨Ø¹ (Debug Channel)</h2>
        <p style="color:var(--text-secondary);font-size:0.88rem;margin:0 0 1rem;">
            Ø§Ù„Ø¨ÙˆØª Ø³ÙŠÙØ±Ø³Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø©/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù†ØªÙŠØ¬Ø© ÙƒÙ„ ØªØ­Ù„ÙŠÙ„ ÙŠØ¬Ø±ÙŠÙ‡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:
            Ø§Ù„Ø±Ø³Ø§Ù„Ø© + Ø§Ù„Ù†ØªÙŠØ¬Ø© + Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… + Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø°.
        </p>

        {% if debug_channel_id %}
        <div
            style="background:#6366f122;border:1px solid #6366f155;border-radius:8px;padding:0.75rem 1rem;margin-bottom:1rem;font-size:0.9rem;">
            âœ… Ù…ÙÙØ¹ÙÙ‘Ù„Ø© Ø§Ù„Ø¢Ù† â€” Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø©: <code style="color:#a5b4fc;">{{ debug_channel_id }}</code>
        </div>
        {% endif %}

        <form method="post" action="/dashboard/ai-prompt/debug-channel/save"
            style="display:flex;gap:0.75rem;align-items:center;margin-bottom:0.75rem;">
            <input type="text" name="channel_id" value="{{ debug_channel_id or '' }}"
                placeholder="Ù…Ø«Ø§Ù„: -100123456789 Ø£Ùˆ @mychannel"
                style="flex:1;background:var(--bg-hover);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-family:inherit;font-size:0.9rem;padding:0.6rem 1rem;outline:none;direction:ltr;"
                required>
            <button type="submit" class="btn-save" style="padding:0.6rem 1.2rem;font-size:0.9rem;">ğŸ’¾ Ø­ÙØ¸</button>
        </form>

        {% if debug_channel_id %}
        <form method="post" action="/dashboard/ai-prompt/debug-channel/clear"
            onsubmit="return confirm('Ø¥ÙŠÙ‚Ø§Ù Ù‚Ù†Ø§Ø© Ø§Ù„ØªØªØ¨Ø¹ØŸ')">
            <button type="submit" class="btn-reset" style="font-size:0.85rem;padding:0.5rem 1rem;">â›” Ø¥ÙŠÙ‚Ø§Ù
                Ø§Ù„ØªØªØ¨Ø¹</button>
        </form>
        {% endif %}

        <p style="color:var(--text-secondary);font-size:0.78rem;margin-top:0.75rem;">
            ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙˆØª Ù…ÙØ¶Ø§Ù Ù„Ù„Ù‚Ù†Ø§Ø©/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒÙ…Ø´Ø±Ù Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ© Ù†Ø´Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.
        </p>
    </div>
</div>
{% endblock %}