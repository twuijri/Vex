{% extends "base.html" %}

{% block title %}Vex โ ูุญุฑุฑ ุจุฑููุจุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู{% endblock %}

{% block head %}
<style>
    .prompt-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .prompt-textarea {
        width: 100%;
        min-height: 220px;
        background: var(--bg-hover);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-primary);
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        padding: 1rem;
        outline: none;
        resize: vertical;
        direction: ltr;
        box-sizing: border-box;
        transition: border-color 0.2s;
    }

    .prompt-textarea:focus {
        border-color: var(--primary-color);
    }

    .btn-save {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.65rem 1.5rem;
        font-family: inherit;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    .btn-save:hover {
        opacity: 0.9;
    }

    .btn-reset {
        background: #dc262622;
        color: #f87171;
        border: 1px solid #f8717133;
        border-radius: 8px;
        padding: 0.65rem 1.2rem;
        font-family: inherit;
        font-size: 0.95rem;
        font-weight: 700;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    .btn-reset:hover {
        opacity: 0.8;
    }

    .hint-box {
        background: #6366f111;
        border: 1px solid #6366f144;
        border-radius: 8px;
        padding: 0.85rem 1rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        direction: rtl;
    }

    .hint-box code {
        background: #ffffff15;
        padding: 0.1rem 0.4rem;
        border-radius: 4px;
        font-family: monospace;
        color: #a5b4fc;
    }

    .disabled-note {
        background: #f8717122;
        border: 1px solid #f8717144;
        border-radius: 8px;
        padding: 0.85rem 1rem;
        font-size: 0.9rem;
        color: #f87171;
        margin-bottom: 1.5rem;
        text-align: center;
        font-weight: 600;
    }

    .flash {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-weight: 600;
    }

    .flash-ok {
        background: #16a34a22;
        color: #4ade80;
    }
</style>
{% endblock %}

{% block nav %}
<nav class="navbar">
    <div class="nav-brand">
        <span class="nav-logo">๐ค</span>
        <span class="nav-title">Vex</span>
        <span class="nav-badge">@{{ bot_username }}</span>
    </div>
    <div class="nav-links">
        <a href="/dashboard/" class="nav-link">๐ ููุญุฉ ุงูุชุญูู</a>
        <a href="/dashboard/groups" class="nav-link">๐ฅ ุงููุฌููุนุงุช</a>
        <a href="/dashboard/users" class="nav-link">๐ค ุงููุณุชุฎุฏููู</a>
        <a href="/dashboard/logs" class="nav-link">๐ ุงูุณุฌูุงุช</a>
        <a href="/dashboard/ai-stats" class="nav-link">๐ ุงูุฅุญุตุงุฆูุงุช</a>
        <a href="/dashboard/ai-providers" class="nav-link">๐ค ูุฒูุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</a>
        <a href="/dashboard/ai-prompt" class="nav-link active">โ๏ธ ุจุฑููุจุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู</a>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="dashboard">
    <h1 class="page-title">โ๏ธ ูุญุฑุฑ ุจุฑููุจุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h1>
    <p style="color:var(--text-secondary);margin-bottom:1.5rem;">
        ููุฑุณูู ูุฐุง ุงูุจุฑููุจุช ูุน ูู ุฑุณุงูุฉ ูุญูููุง ุงูุฐูุงุก ุงูุงุตุทูุงุนู. ูุฌุจ ุฃู ูุญุชูู ุนูู <code
            style="background:#ffffff15;padding:0.1rem 0.4rem;border-radius:4px;color:#a5b4fc;">{text}</code> ุญูุซ ุชููุถุน
        ุงูุฑุณุงูุฉ.
    </p>

    {% if not has_providers %}
    <div class="disabled-note">
        โ๏ธ ูุง ูููู ุชูุนูู ูุฐู ุงูููุฒุฉ โ ูู ุชูุถู ุฃู ูุฒูุฏ ุฐูุงุก ุงุตุทูุงุนู ุจุนุฏ.
        <br><a href="/dashboard/ai-providers" style="color:#f87171;">ุฃุถู ูุฒูุฏุงู ูู ููุง โ</a>
    </div>
    {% endif %}

    {% if msg %}
    <div class="flash flash-ok">{{ msg }}</div>
    {% endif %}

    <!-- Current prompt editor -->
    <div class="prompt-card">
        <h2 style="margin:0 0 1rem;font-size:1rem;">๐ ุงูุจุฑููุจุช ุงูุญุงูู</h2>

        <div class="hint-box">
            ๐ก ุงูุชุจ <strong>ุชุนูููุงุชู ููุท</strong> โ ุงูุจูุช ููุถูู <u>ุชููุงุฆูุงู</u> ูู ููุงูุฉ ุจุฑููุจุชู:
            <code>ุงูุฑุณุงูุฉ: ยซ...ยป</code> + <code>ุฃุฌุจ ุจุฑูู 0.0-1.0 ููุท</code>
            โ ูุง ุชุญุชุงุฌ ูุฅุถุงูุชูู.
        </div>

        <form method="post" action="/dashboard/ai-prompt/save">
            <textarea class="prompt-textarea" name="prompt" {% if not has_providers %}disabled{% endif
                %}>{{ current_prompt }}</textarea>
            <div style="display:flex;gap:1rem;margin-top:1rem;">
                <button type="submit" class="btn-save" {% if not has_providers %}disabled{% endif %}>๐พ ุญูุธ
                    ุงูุจุฑููุจุช</button>
            </div>
        </form>
    </div>

    <!-- Reset to default -->
    <div class="prompt-card">
        <h2 style="margin:0 0 0.5rem;font-size:1rem;">๐ ุฅุนุงุฏุฉ ุงูุถุจุท ุฅูู ุงูุงูุชุฑุงุถู</h2>
        <p style="color:var(--text-secondary);font-size:0.9rem;margin:0 0 1rem;">
            ูุฐุง ููุนูุฏ ุงูุจุฑููุจุช ุงููุฏูุฌ ูู ุงูููุฏ ููุง ูุญุฐู ุฃู ุดูุก ุจุดูู ุฏุงุฆู.
        </p>
        <form method="post" action="/dashboard/ai-prompt/reset"
            onsubmit="return confirm('ุฅุนุงุฏุฉ ุถุจุท ุงูุจุฑููุจุช ุฅูู ุงูุงูุชุฑุงุถูุ')">
            <button type="submit" class="btn-reset" {% if not has_providers %}disabled{% endif %}>โป๏ธ ุฅุนุงุฏุฉ ุงูุถุจุท ุฅูู
                ุงูุงูุชุฑุงุถู</button>
        </form>
    </div>

    <div class="prompt-card" style="border-color:#6366f133;">
        <h2 style="margin:0 0 1rem;font-size:1rem;">๐ ูุง ููุถุงู ุชููุงุฆูุงู ุจุนุฏ ุชุนูููุงุชู (ุซุงุจุช)</h2>
        <pre
            style="background:#6366f111;border:1px solid #6366f133;border-radius:8px;padding:1rem;font-size:0.85rem;direction:ltr;color:#a5b4fc;margin:0;">ุงูุฑุณุงูุฉ: ยซ[...ูุต ุงูุฑุณุงูุฉ...]ยป
ุฃุฌุจ ุจุฑูู ุนุดุฑู ููุท ุจูู 0.0 ู 1.0ุ ูุง ุดูุก ุขุฎุฑ.</pre>
        <p style="color:var(--text-secondary);font-size:0.8rem;margin:0.75rem 0 0;">ุชูุถุงู ูุฐู ุงูุฃุณุทุฑ ุจุนุฏ ุชุนูููุงุชู ุฏุงุฆูุงู
            โ ูุง ุชุญุชุงุฌ ููุชุงุจุชูุง.</p>
    </div>

    <!-- Default instructions reference -->
    <div class="prompt-card">
        <h2 style="margin:0 0 1rem;font-size:1rem;">๐ ุงูุชุนูููุงุช ุงูุงูุชุฑุงุถูุฉ (ููุฑุฌูุน ุฅูููุง)</h2>
        <pre
            style="background:var(--bg-hover);border-radius:8px;padding:1rem;font-size:0.8rem;direction:ltr;overflow-x:auto;color:var(--text-secondary);margin:0;">{{ default_prompt }}</pre>
    </div>

    <!-- Debug Channel -->
    <div class="prompt-card"
        style="border-color:{% if debug_channel_id %}#6366f1{% else %}var(--border-color){% endif %};">
        <h2 style="margin:0 0 0.5rem;font-size:1rem;">๐ฌ ููุงุฉ ุงูุชุชุจุน (Debug Channel)</h2>
        <p style="color:var(--text-secondary);font-size:0.88rem;margin:0 0 1rem;">
            ุงูุจูุช ุณููุฑุณู ููุฐู ุงูููุงุฉ/ุงููุฌููุนุฉ ูุชูุฌุฉ ูู ุชุญููู ูุฌุฑูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู:
            ุงูุฑุณุงูุฉ + ุงููุชูุฌุฉ + ุดุฑูุท ุงูุชูุฏู + ุงูุฅุฌุฑุงุก ุงููุชุฎุฐ.
        </p>

        {% if debug_channel_id %}
        <div
            style="background:#6366f122;border:1px solid #6366f155;border-radius:8px;padding:0.75rem 1rem;margin-bottom:1rem;font-size:0.9rem;">
            โ ูููุนูููุฉ ุงูุขู โ ูุนุฑู ุงูููุงุฉ: <code style="color:#a5b4fc;">{{ debug_channel_id }}</code>
        </div>
        {% endif %}

        <form method="post" action="/dashboard/ai-prompt/debug-channel/save"
            style="display:flex;gap:0.75rem;align-items:center;margin-bottom:0.75rem;">
            <input type="text" name="channel_id" value="{{ debug_channel_id or '' }}"
                placeholder="ูุซุงู: -100123456789 ุฃู @mychannel"
                style="flex:1;background:var(--bg-hover);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-family:inherit;font-size:0.9rem;padding:0.6rem 1rem;outline:none;direction:ltr;"
                required>
            <button type="submit" class="btn-save" style="padding:0.6rem 1.2rem;font-size:0.9rem;">๐พ ุญูุธ</button>
        </form>

        {% if debug_channel_id %}
        <form method="post" action="/dashboard/ai-prompt/debug-channel/clear"
            onsubmit="return confirm('ุฅููุงู ููุงุฉ ุงูุชุชุจุนุ')">
            <button type="submit" class="btn-reset" style="font-size:0.85rem;padding:0.5rem 1rem;">โ ุฅููุงู
                ุงูุชุชุจุน</button>
        </form>
        {% endif %}

        <p style="color:var(--text-secondary);font-size:0.78rem;margin-top:0.75rem;">
            ๐ก ุชุฃูุฏ ูู ุฃู ุงูุจูุช ููุถุงู ููููุงุฉ/ุงููุฌููุนุฉ ููุดุฑู ูุน ุตูุงุญูุฉ ูุดุฑ ุงูุฑุณุงุฆู.
        </p>
    </div>
</div>
{% endblock %}