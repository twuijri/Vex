{% extends "base.html" %}
{% block title %}Vex โ ูุญุฑุฑ ุงูุจุฑููุจุช{% endblock %}
{% block page_title %}โ๏ธ ูุญุฑุฑ ุจุฑููุจุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ูุญุฑุฑ ุงูุจุฑููุจุช</h1>
    <p class="page-subtitle">ุฎุตูุต ุชุนูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุญููู ุงูุฑุณุงุฆู</p>
</div>

{% if not has_providers %}
<div class="alert alert-warning">
    โ๏ธ ูุง ูููู ุชุนุฏูู ุงูุจุฑููุจุช ุญุชู ุชูุถูู ูุฒูุฏ ุฐูุงุก ุงุตุทูุงุนู.
    <a href="/dashboard/ai-providers" style="color:inherit;font-weight:700;"> ุฅุถุงูุฉ ูุฒูุฏ โ</a>
</div>
{% endif %}

{% if msg %}
<div class="alert alert-success">{{ msg }}</div>
{% endif %}

<!-- Prompt Editor -->
<div class="card" style="margin-bottom:1rem;">
    <h2 style="font-size:0.95rem;font-weight:700;color:var(--primary);margin-bottom:0.75rem;">๐ ุชุนูููุงุชู (ุงูุจุฑููุจุช
        ุงูุญุงูู)</h2>
    <div class="hint-box">
        ๐ก ุงูุชุจ <strong>ุชุนูููุงุชู ููุท</strong> โ ุงูุจูุช ููุถูู <u>ุชููุงุฆูุงู</u> ูู ุงูููุงูุฉ:
        ุงูุฑุณุงูุฉ + ุทูุจ ุงูุฑูู ุจูู 0.0-1.0
    </div>
    <form method="post" action="/dashboard/ai-prompt/save" id="prompt-save-form">
        <textarea class="textarea-field" name="prompt" {% if not has_providers %}disabled{% endif
            %}>{{ current_prompt }}</textarea>
    </form>
    <form method="post" action="/dashboard/ai-prompt/reset" id="prompt-reset-form"
        onsubmit="return confirm('ุฅุนุงุฏุฉ ุงูุถุจุท ุฅูู ุงูุงูุชุฑุงุถูุ')"></form>
    <div style="display:flex;gap:0.75rem;margin-top:1rem;flex-wrap:wrap;">
        <button type="submit" form="prompt-save-form" class="btn btn-primary" {% if not has_providers %}disabled{% endif
            %}>๐พ ุญูุธ ุงูุจุฑููุจุช</button>
        <button type="submit" form="prompt-reset-form" class="btn btn-danger" {% if not has_providers %}disabled{% endif
            %}>โป๏ธ ุฅุนุงุฏุฉ ุงูุถุจุท</button>
    </div>
</div>

<!-- Fixed Suffix -->
<div class="card" style="margin-bottom:1rem;border-color:var(--secondary);">
    <h2 style="font-size:0.95rem;font-weight:700;color:var(--primary);margin-bottom:0.75rem;">๐ ููุถุงู ุชููุงุฆูุงู ุจุนุฏ
        ุชุนูููุงุชู (ุซุงุจุช)</h2>
    <div class="suffix-box">ุงูุฑุณุงูุฉ: ยซ[ูุต ุงูุฑุณุงูุฉ]ยป
        ุฃุฌุจ ุจุฑูู ุนุดุฑู ููุท ุจูู 0.0 ู 1.0ุ ูุง ุดูุก ุขุฎุฑ.</div>
    <p style="color:var(--text-muted);font-size:0.78rem;margin-top:0.5rem;">ูุฐู ุงูุฃุณุทุฑ ุชูุถุงู ุฏุงุฆูุงู โ ูุง ุชูุชุจูุง ูู
        ุชุนูููุงุชู.</p>
</div>

<!-- Default Reference -->
<div class="card" style="margin-bottom:1rem;">
    <h2 style="font-size:0.95rem;font-weight:700;color:var(--primary);margin-bottom:0.75rem;">๐ ุงูุชุนูููุงุช ุงูุงูุชุฑุงุถูุฉ
        (ููุฑุฌูุน ุฅูููุง)</h2>
    <pre
        style="background:var(--bg);border-radius:10px;padding:1rem;font-size:0.8rem;direction:ltr;overflow-x:auto;color:var(--text-muted);">{{ default_prompt }}</pre>
</div>

<!-- Debug Channel -->
<div class="card" style="border-color:{% if debug_channel_id %}var(--success){% else %}var(--border){% endif %};">
    <h2 style="font-size:0.95rem;font-weight:700;color:var(--primary);margin-bottom:0.5rem;">๐ฌ ููุงุฉ ุงูุชุชุจุน (Debug
        Channel)</h2>
    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:1rem;">
        ุงูุจูุช ููุฑุณู ููุฐู ุงูููุงุฉ ูุชูุฌุฉ ูู ุชุญููู: ุงูุฑุณุงูุฉ + ุงููุชูุฌุฉ + ุงูุฅุฌุฑุงุก.
    </p>

    {% if debug_channel_id %}
    <div class="debug-active">โ ูููุนูููุฉ โ ูุนุฑู ุงูููุงุฉ: <code>{{ debug_channel_id }}</code></div>
    {% endif %}

    <form method="post" action="/dashboard/ai-prompt/debug-channel/save"
        style="display:flex;gap:0.75rem;align-items:center;margin-bottom:0.75rem;flex-wrap:wrap;">
        <input class="input" type="text" name="channel_id" value="{{ debug_channel_id or '' }}"
            placeholder="ูุซุงู: -100123456789" style="flex:1;min-width:200px;direction:ltr;" required>
        <button type="submit" class="btn btn-primary">๐พ ุญูุธ</button>
    </form>

    {% if debug_channel_id %}
    <form method="post" action="/dashboard/ai-prompt/debug-channel/clear"
        onsubmit="return confirm('ุฅููุงู ููุงุฉ ุงูุชุชุจุนุ')">
        <button type="submit" class="btn btn-danger btn-sm">โ ุฅููุงู ุงูุชุชุจุน</button>
    </form>
    {% endif %}

    <p style="color:var(--text-muted);font-size:0.78rem;margin-top:0.75rem;">
        ๐ก ุชุฃูุฏ ูู ุฅุถุงูุฉ ุงูุจูุช ููููุงุฉ ููุดุฑู ูุน ุตูุงุญูุฉ ุงููุดุฑ.
    </p>
</div>
{% endblock %}