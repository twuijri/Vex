{% extends "base.html" %}

{% block title %}Vex â€” Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ{% endblock %}

{% block head %}
<style>
    .ai-stats-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        border-radius: 12px;
        overflow: hidden;
    }

    .ai-stats-table th {
        background: var(--bg-hover);
        padding: 0.85rem 1rem;
        text-align: right;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .ai-stats-table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.95rem;
    }

    .ai-stats-table tr:last-child td {
        border-bottom: none;
    }

    .ai-stats-table tr:hover td {
        background: var(--bg-hover);
    }

    /* Status badges */
    .badge {
        display: inline-block;
        padding: 0.2rem 0.65rem;
        border-radius: 99px;
        font-size: 0.78rem;
        font-weight: 600;
    }

    .badge-ok {
        background: #16a34a22;
        color: #4ade80;
    }

    .badge-ratelimit {
        background: #d9770622;
        color: #fb923c;
    }

    .badge-error {
        background: #dc262622;
        color: #f87171;
    }

    .badge-day {
        background: #7c3aed22;
        color: #a78bfa;
    }

    /* Summary cards */
    .provider-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .provider-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.2rem 1.5rem;
    }

    .provider-card .p-name {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.4rem;
    }

    .provider-card .p-count {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        line-height: 1;
    }

    .provider-card .p-sub {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 0.3rem;
    }

    /* Bar strip */
    .usage-bar-wrap {
        height: 6px;
        background: var(--bg-hover);
        border-radius: 99px;
        margin-top: 0.6rem;
        overflow: hidden;
    }

    .usage-bar {
        height: 100%;
        background: linear-gradient(90deg, #6366f1, #8b5cf6);
        border-radius: 99px;
        transition: width 0.5s ease;
    }
</style>
{% endblock %}

{% block nav %}
<nav class="navbar">
    <div class="nav-brand">
        <span class="nav-logo">ğŸ¤–</span>
        <span class="nav-title">Vex</span>
        <span class="nav-badge">@{{ bot_username }}</span>
    </div>
    <div class="nav-links">
        <a href="/dashboard/" class="nav-link">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="/dashboard/groups" class="nav-link">ğŸ‘¥ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</a>
        <a href="/dashboard/users" class="nav-link">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
        <a href="/dashboard/logs" class="nav-link">ğŸ“‘ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</a>
        <a href="/dashboard/ai-stats" class="nav-link active">ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</a>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="dashboard">
    <h1 class="page-title">ğŸ¤– Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” Ø¢Ø®Ø± 30 ÙŠÙˆÙ…</h1>

    {% if not summaries %}
    <div class="empty-state">
        <div class="empty-icon">ğŸŒ™</div>
        <div class="empty-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ â€” Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© ÙŠØ­Ù„Ù„Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</div>
    </div>
    {% else %}

    <!-- Summary Cards -->
    <div class="provider-summary">
        {% for s in summaries %}
        <div class="provider-card">
            <div class="p-name">{{ s.label }}</div>
            <div class="p-count">{{ s.total }}</div>
            <div class="p-sub">Ø·Ù„Ø¨ ÙÙŠ Ø¢Ø®Ø± 30 ÙŠÙˆÙ…</div>
            {% if s.limit %}
            <div class="usage-bar-wrap">
                <div class="usage-bar" style="width: {{ [s.today_pct, 100]|min }}%"></div>
            </div>
            <div class="p-sub">Ø§Ù„ÙŠÙˆÙ…: {{ s.today }} / {{ s.limit }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Detailed Table -->
    <div class="log-container" style="height: auto;">
        <div class="log-header">
            <strong>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</strong>
            <a href="/dashboard/ai-stats" class="btn-refresh">ğŸ”„ ØªØ­Ø¯ÙŠØ«</a>
        </div>
        <table class="ai-stats-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø·Ù„Ø¨Ø§Øª</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
                    <th>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for row in stats %}
                <tr>
                    <td><strong>{{ row.provider }}</strong></td>
                    <td>{{ row.date }}</td>
                    <td>{{ row.requests }}</td>
                    <td>
                        {% if row.status == 'ok' %}
                        <span class="badge badge-ok">âœ… Ù†Ø§Ø¬Ø­</span>
                        {% elif row.status == 'rate_limit_minute' %}
                        <span class="badge badge-ratelimit">â³ Ø­Ø¯ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©</span>
                        {% elif row.status == 'rate_limit_day' %}
                        <span class="badge badge-day">ğŸš« Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…</span>
                        {% elif row.status == 'error' %}
                        <span class="badge badge-error">âŒ Ø®Ø·Ø£</span>
                        {% else %}
                        <span class="badge">{{ row.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ row.last_used }}</td>
                    <td style="font-size:0.75rem;color:var(--text-secondary);max-width:300px;word-break:break-all;">
                        {{ row.error or 'â€”' }}
                    </td>
                    <td>
                        <form method="post" action="/dashboard/ai-stats/{{ row.id }}/delete">
                            <button style="background:none;border:none;cursor:pointer;font-size:1rem;color:#f87171;"
                                title="Ø­Ø°Ù" onclick="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')">ğŸ—‘ï¸</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}